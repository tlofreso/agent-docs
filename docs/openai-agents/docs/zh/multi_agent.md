---
search:
  exclude: true
---
# 多智能体编排

编排指的是你在应用中对智能体的流程控制：哪些智能体运行、按什么顺序运行、以及它们如何决定下一步。编排智能体主要有两种方式：

1. 让 LLM 做决策：利用 LLM 的智能来规划、推理，并据此决定采取哪些步骤。
2. 通过代码进行编排：用你的代码来确定智能体的执行流程。

你可以混合使用这些模式。它们各有取舍，详见下文。

## 通过 LLM 编排

一个智能体是配备了 instructions、工具和 任务转移 的 LLM。这意味着面对一个开放式任务时，LLM 可以自主规划其完成方式，使用工具来执行操作和获取数据，并通过 任务转移 将任务委派给子智能体。比如，一个研究智能体可以配备以下工具：

- 网络检索，用于在网上查找信息
- 文件检索与获取，用于在专有数据与连接中搜索
- 计算机操作，用于在计算机上执行操作
- 代码执行，用于进行数据分析
- 任务转移，到擅长规划、写作报告等的专业智能体

当任务是开放式且你希望依赖 LLM 的智能时，这种模式非常适合。关键做法包括：

1. 打磨高质量提示词。明确可用工具、使用方式，以及必须遵循的参数与边界。
2. 监控你的应用并迭代优化。观察问题出现的位置，并迭代你的提示词。
3. 允许智能体自省与改进。例如在循环中运行并让其自我评议；或提供错误信息并让其改进。
4. 让专业智能体各司其职，而不是指望一个通用智能体样样精通。
5. 投入于[评测](https://platform.openai.com/docs/guides/evals)。这可帮助你训练智能体改进并提升任务表现。

## 通过代码编排

尽管通过 LLM 编排很强大，但通过代码编排在速度、成本和性能方面更具确定性和可预测性。常见模式包括：

- 使用[structured outputs](https://platform.openai.com/docs/guides/structured-outputs)生成可由你的代码检查的 格式良好的数据。比如，你可以让智能体将任务分类到几个目录中，然后基于该目录选择下一个智能体。
- 将多个智能体串联，把一个的输出转成下一个的输入。你可以将撰写博客这样的任务分解为一系列步骤——做研究、写大纲、写正文、评议并改进。
- 将执行任务的智能体与进行评估并提供反馈的智能体一起在 `while` 循环中运行，直到评估者确认输出通过某些标准。
- 并行运行多个智能体，例如通过 Python 基本组件如 `asyncio.gather`。当你有多个彼此独立的任务时，这有助于提速。

我们在[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns)中提供了许多代码示例。