---
search:
  exclude: true
---
# 协调多个智能体

协调是指应用中智能体的流程：哪些智能体运行、以何种顺序运行，以及它们如何决定下一步该做什么。协调智能体有两种主要方式：

1. 允许 LLM 做出决策：利用 LLM 的智能进行规划、推理，并据此决定采取哪些步骤。
2. 通过代码进行协调：用代码确定智能体的流程。

你可以混合使用这些模式。每种方式都有各自的权衡，见下文。

## 通过 LLM 协调

智能体是配备了指令（instructions）、工具（tools）和任务转移（handoffs）的 LLM。这意味着在给定一个开放式任务时，LLM 可以自主规划如何处理该任务，使用工具采取行动并获取数据，并使用任务转移将工作委派给子智能体。例如，一个研究智能体可以配备以下工具：

- 网络检索，用于在网上查找信息
- 文件检索与获取，用于搜索专有数据和连接
- 计算机操作，用于在计算机上执行操作
- 代码执行，用于进行数据分析
- 任务转移到擅长规划、撰写报告等的专业智能体

当任务是开放式且你希望依赖 LLM 的智能时，这种模式非常适合。这里最重要的做法是：

1. 打磨高质量的提示词。明确说明有哪些工具、如何使用，以及必须遵守的参数范围。
2. 监控并迭代你的应用。观察问题出在哪里，并迭代优化提示词。
3. 允许智能体自省与改进。例如，将其置于循环中，让其自我批判；或提供错误信息并让其改进。
4. 使用在某一任务上表现突出的专业智能体，而不是期望一个通用智能体在所有方面都很强。
5. 投入到[评测 (evals)](https://platform.openai.com/docs/guides/evals)。这可以训练你的智能体不断改进，提升完成任务的能力。

## 通过代码协调

虽然通过 LLM 协调很强大，但通过代码协调可以在速度、成本和性能方面使任务更确定、更可预测。常见模式包括：

- 使用[structured outputs](https://platform.openai.com/docs/guides/structured-outputs)生成你可以用代码检查的格式良好的数据。例如，你可以让智能体将任务分类到若干目录中，然后依据该目录选择下一个智能体。
- 将多个智能体串联起来，把一个的输出转换为下一个的输入。你可以将撰写博客这样的任务分解为一系列步骤——进行研究、写提纲、写正文、批判性审阅，然后改进。
- 让执行任务的智能体与负责评估和反馈的智能体在 `while` 循环中运行，直到评估者认为输出通过了某些标准。
- 并行运行多个智能体，例如通过 Python 的基础组件如 `asyncio.gather`。当你有多个彼此不依赖的任务时，这对提升速度很有帮助。

我们在[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns)中提供了许多代码示例。